<% provide(:title, "Phenolic Content") %>
<% provide(:p, "This graph represents the measurements of phenolic content that was gathered from the study of the 68 herbs. Information about what phenolic content is can be found below the graph. Please tap on a bar to learn more.") %>

<div class="container">

	<center>
		<div id="graphOne">
		</div>
	</center>
		<%= render 'static_pages/phenolic_compounds' %>
</div>

<script>
var herbs = "<%= @herbs %>";
var split_herbs = herbs.split('], [');
//console.log("herbs: " + herbs);
//console.log("split_herbs: " + split_herbs);
for(var i=0; i < split_herbs.length; i++){
  split_herbs[i] = split_herbs[i].split(';, &');
  //console.log("**split_herbs["+i+"]: " + split_herbs[i]);
  for(var j=0; j < split_herbs[i].length; j++){
    split_herbs[i][j] =  split_herbs[i][j].replace("&quot;","");
    split_herbs[i][j] =  split_herbs[i][j].replace("quot;","");
    split_herbs[i][j] =  split_herbs[i][j].replace("&quot","");
    console.log(">> split_herbs["+i+"]["+j+"]: " + split_herbs[i][j]);
  }
}

var dataArray = [23, 13, 21, 14, 37, 15, 18, 34, 30];

var svg = d3.select("#graphOne").append("svg")
  .attr("height", 600)
  .attr("width", 500)

var div = d3.select("#graphOne").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);


var g = svg.append("g")
					.attr("transform", "translate(" + 200 + "," + 200 + ")");

var xScale = d3.scaleBand().range([0, 500]),
		yScale = d3.scaleLinear().range([200, 0]);

xScale.domain(split_herbs.map(function(d) { return d[0]; }));
yScale.domain([0, d3.max(split_herbs, function(d) { return d[1]; })]);

g.append("g")
		.attr("transform", "translate(0," + 200 + ")")
		.call(d3.axisBottom(xScale));

g.append("g")
		.call(d3.axisLeft(yScale).tickFormat(function(d){
			return d[1];
		}).ticks(10))
		.append("text")
		.attr("y", 6)
		.attr("dy", "0.71em")
		.attr("text-anchor", "end")
		.text("value");


svg.selectAll("rect")
  .data(split_herbs)
  .enter().append("rect")
    .attr("class", "bar")
    .attr("height", function(d, i){ console.log("d: " + d); return d[1]*2;})
    .attr("width", "7")
    .attr("x", function(d, i){ return (i * 7);})
    .attr("y", function(d, i){ return 600 - (d[1]*2);})
    .attr("stroke", "black")
    .attr("stroke-width", "0.5")
    .on('mouseover', function(d, i){
        div.transition()
          .duration(200)
          .style("opacity", .9);
        div.html("<center>" + d[0] + " has a mean of <br>" + d[1] + " mg GAE/g dw of Phenolic content </center>")
          .style("left", (d3.event.pageX) + "px")
          .style("top", (d3.event.pageY - 28) + "px")
          .style("white-space", "nowrap")
          .style("border", "1px solid rgba(122, 122, 122, 0.5)")
          .style("border-radius", "5px")
          .style("background-color", "#eaf4ff");
    });
   

</script>
